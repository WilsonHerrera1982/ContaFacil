@using ContaFacil.Models.Dto
@model (List<ProductoDTO> NuevosProductos, List<ProductoDTO> ProductosRegistrados)

<h2>Resultados de la carga</h2>
@if (Model.NuevosProductos.Any())
{
    <h3>Nuevos Productos</h3>
<table class="table table-striped table-bordered table-hover">
    <thead class="thead-dark">
        <tr>
            <th>Código de producto</th>
            <th>Nombre del producto</th>
            <th>Descripción del producto</th>
            <th>Cuenta contable</th>
            <th>Usuario de Creación</th>
            <th>Unidad de Medida</th>
            <th>Factura Nro.</th>
            <th>Id Proveedor</th>
            <th>Proveedor</th>
            <th>Fecha de creación</th>
            <th>Cantidad</th>
            <th>Valor Unitario</th>
            <th>2% Descuento</th>
            <th>Subtotal</th>
            <th>IVA 15%</th>
            <th>Total</th>
            <th>Carga Inicial</th>
        </tr>
    </thead>
    <tbody>
            @foreach (var producto in Model.NuevosProductos)
        {
            <tr>
                <td>@producto.CodigoProducto</td>
                <td>@producto.NombreProducto</td>
                <td>@producto.DescripcionProducto</td>
                <td>@producto.CuentaContable</td>
                <td>@producto.UsuarioCreacion</td>
                <td>@producto.UnidadMedida</td>
                <td>@producto.FacturaNro</td>
                <td>@producto.IdProveedor</td>
                <td>@producto.Proveedor</td>
                <td>@producto.FechaCreacion.ToString("dd/MM/yyyy")</td>
                <td>@producto.Cantidad.ToString("N2")</td>
                <td>@producto.ValorUnitario.ToString("C2")</td>
                <td>@producto.Descuento.ToString("C2")</td>
                <td>@producto.Subtotal.ToString("C2")</td>
                <td>@producto.IVA.ToString("C2")</td>
                <td>@producto.Total.ToString("C2")</td>
                <td>@(producto.CargaInicial ? "Sí" : "No")</td>
            </tr>
        }
    </tbody>
</table>
}
<div class="mt-3">
    <p>Total de nuevos productos: @Model.NuevosProductos.Count</p>
</div>
@if (Model.ProductosRegistrados != null && Model.ProductosRegistrados.Any())
{
    <h3>Productos Ya Registrados</h3>
    <table class="table table-striped table-bordered table-hover">
        <!-- Encabezados de la tabla -->
        <thead class="thead-dark">
            <tr>
                <th>Código de producto</th>
                <th>Nombre del producto</th>
                <th>Descripción del producto</th>
                <th>Cuenta contable</th>
                <th>Usuario de Creación</th>
                <th>Unidad de Medida</th>
                <th>Factura Nro.</th>
                <th>Id Proveedor</th>
                <th>Proveedor</th>
                <th>Fecha de creación</th>
                <th>Cantidad</th>
                <th>Valor Unitario</th>
                <th>2% Descuento</th>
                <th>Subtotal</th>
                <th>IVA 15%</th>
                <th>Total</th>
                <th>Carga Inicial</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var producto in Model.ProductosRegistrados)
            {
                <tr>
                    <td>@producto.CodigoProducto</td>
                    <td>@producto.NombreProducto</td>
                    <td>@producto.DescripcionProducto</td>
                    <td>@producto.CuentaContable</td>
                    <td>@producto.UsuarioCreacion</td>
                    <td>@producto.UnidadMedida</td>
                    <td>@producto.FacturaNro</td>
                    <td>@producto.IdProveedor</td>
                    <td>@producto.Proveedor</td>
                    <td>@producto.FechaCreacion.ToString("dd/MM/yyyy")</td>
                    <td>@producto.Cantidad.ToString("N2")</td>
                    <td>@producto.ValorUnitario.ToString("C2")</td>
                    <td>@producto.Descuento.ToString("C2")</td>
                    <td>@producto.Subtotal.ToString("C2")</td>
                    <td>@producto.IVA.ToString("C2")</td>
                    <td>@producto.Total.ToString("C2")</td>
                    <td>@(producto.CargaInicial ? "Sí" : "No")</td>
                </tr>
            }
        </tbody>
    </table>
    <div class="mt-3">
        <p>Total de productos ya registrados: @Model.ProductosRegistrados.Count</p>       
    </div>
    <div class="alert alert-danger mt-3">
       Los nombres y descripcion de los prodcutos ya se encuentran registrados, estos no se incluiran en el inventario.
    </div>
}
@if (@Model.NuevosProductos.Count > 0)
{
    <div class="mt-3">
        <h3>Resumen</h3>
        <p>Total de productos: @Model.NuevosProductos.Count</p>
        <p>Valor total: @Model.NuevosProductos.Sum(p => p.Total).ToString("C2")</p>
        <p>Producto más caro: @Model.NuevosProductos.OrderByDescending(p => p.ValorUnitario).First().NombreProducto (@Model.NuevosProductos.Max(p => p.ValorUnitario).ToString("C2"))</p>
        <p>Producto más barato: @Model.NuevosProductos.OrderBy(p => p.ValorUnitario).First().NombreProducto (@Model.NuevosProductos.Min(p => p.ValorUnitario).ToString("C2"))</p>
    </div>
}
else
{
    <div class="alert alert-warning mt-3">
        No se cargaron productos.
    </div>
}

<div class="container mt-4">
    <div class="row row-cols-1 row-cols-md-3 g-4">
        <div class="col">
            <a asp-action="CargarExcel" class="btn btn-primary">Volver a cargar</a>
            </div>
                <div class="col">
                    @if (@Model.NuevosProductos.Count > 0)
                    {
                        <form asp-action="RegistrarInventario" method="post">
                            <button type="submit" class="btn btn-primary">Cargar a inventario</button>
                        </form>
                    }
            </div>
        <div class="col">
            <a asp-action="Index">Regresar a opciones</a>
        </div>

</div>
</div>
